- content_for :main do
  
  :javascript
    function busca_cep(id){
      alert($("#termo").html());
      $.ajax({
          url  : "/busca_pelo_logradouro",
          data : {logradouro: $("#termo").html()},
          type : "GET",
          success :function(data){
            alert(data);
          }
        });
    }
    
  
    if(!window.Kolich){
      Kolich = {};
    }

    Kolich.Selector = {};
    // getSelected() was borrowed from CodeToad at
    // http://www.codetoad.com/javascript_get_selected_text.asp
    Kolich.Selector.getSelected = function(){
      var t = '';
      if(window.getSelection){
        t = window.getSelection();
      }else if(document.getSelection){
        t = document.getSelection();
      }else if(document.selection){
        t = document.selection.createRange().text;
      }
      return t;
    }
			
    Kolich.Selector.mouseup = function(){
      var st = Kolich.Selector.getSelected();
      if(st!=''){
        $("#termo").html(st + '');
      }
    }
			
    $(document).ready(function(){
      $(document).bind("mouseup", Kolich.Selector.mouseup);
    });
  
  
  #termo
  %h2
    Mala-direta
  = link_to_function 'Imprime', "window.location = '/clinicas/gera_arquivo_de_mala_direta'"
  %table
    %tr
      %th= 'NÂº'
      %th= "Selec"
      %th= "Nome"
      %th= "Rua"
      %th= "Bairro"
      %th= "Cidade/UF"
      %th= "Cep"
    - @pacientes.each_with_index do |pac, index|
      - if pac.present?
        %tr
          %td= index + 1
          %td= check_box_tag "paciente_#{pac.id}", true,true
          %td= pac.nome
          %td{:id=>"td_#{pac.id}"}= pac.logradouro
          %td= pac.bairro 
          %td= pac.cidade + "/" + pac.uf if pac.cidade && pac.uf
          %td
            = pac.cep 
            = button_to_function "busca", "busca_cep(#{pac.id});" 